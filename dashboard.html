<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: system-ui, sans-serif;
  padding: 20px;
  background: #f5f5f5;
}
h1 {
  margin-bottom: 10px;
}
.card {
  background: #fff;
  padding: 20px;
  margin-top: 15px;
  border-radius: 8px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}
.count {
  font-size: 32px;
  font-weight: bold;
}
.label {
  color: #666;
}
input[type="date"] {
  font-size: 16px;
  padding: 6px;
}
button {
  font-size: 16px;
  padding: 6px 12px;
  margin-left: 8px;
}
</style>
</head>
<body>

<h1>ğŸ“Š ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>

<p>
  æ—¥ä»˜ï¼š
  <input type="date" id="datePicker">
  <button id="loadBtn">è¡¨ç¤º</button>
</p>

<div class="card">
  <div class="label">ç™ºè¡Œæšæ•°</div>
  <div class="count" id="issued">--</div>
</div>

<div class="card">
  <div class="label">ä½¿ç”¨æ¸ˆã¿</div>
  <div class="count" id="used">--</div>
</div>

<div class="card">
  <div class="label">æœªä½¿ç”¨</div>
  <div class="count" id="unused">--</div>
</div>

<script type="module">
/* Firebase SDK */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore,
  collection,
  getDocs,
  query,
  where
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* Firebase è¨­å®š */
const firebaseConfig = {
  apiKey: "AIzaSyALuZuT-PUJ8EGVQ0FfzZvN0c2lMujjqxw",
  authDomain: "ticket-system-acabc.firebaseapp.com",
  projectId: "ticket-system-acabc",
  storageBucket: "ticket-system-acabc.firebasestorage.app",
  messagingSenderId: "738817015202",
  appId: "1:738817015202:web:aa5c5b10c55f1069cec6fb"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ===== æ—¥æœ¬æ™‚é–“ã§ä»Šæ—¥ã®æ—¥ä»˜ ===== */
function getJSTDate() {
  const now = new Date();
  const jst = new Date(now.getTime() + 9 * 60 * 60 * 1000);
  return jst.toISOString().slice(0, 10);
}

/* åˆæœŸæ—¥ä»˜ã‚’ã‚»ãƒƒãƒˆ */
const datePicker = document.getElementById("datePicker");
datePicker.value = getJSTDate();

/* ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ */
async function loadDashboard(date) {
  const colRef = collection(db, "tickets-" + date);

  const allSnap = await getDocs(colRef);
  const usedSnap = await getDocs(
    query(colRef, where("used", "==", true))
  );

  const issued = allSnap.size;
  const used = usedSnap.size;
  const unused = issued - used;

  document.getElementById("issued").textContent = issued;
  document.getElementById("used").textContent = used;
  document.getElementById("unused").textContent = unused;
}

/* ãƒœã‚¿ãƒ³ */
document.getElementById("loadBtn").addEventListener("click", () => {
  loadDashboard(datePicker.value);
});

/* åˆå›è¡¨ç¤º */
loadDashboard(datePicker.value);
</script>

</body>
</html>
