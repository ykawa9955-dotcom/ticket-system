<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>食券発行システム</title>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

</head>
<body>

<h2>無料食券 発行ページ</h2>
<p>発行枚数：<span id="count">--</span> 枚</p>
<button id="issueBtn">食券を発行</button>

<div id="qr"></div>

<script>
// ▼▼ Firebase の設定（あなたのプロジェクト情報に置き換え）
const firebaseConfig = {
    apiKey: "YOUR_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ▼ 今日の日付文字列
const today = new Date().toISOString().slice(0, 10);

// ▼ 発行数を表示
function updateCount() {
    db.collection("tickets-" + today)
      .get()
      .then(s => document.getElementById("count").textContent = s.size);
}
updateCount();

// ▼ 食券発行
document.getElementById("issueBtn").onclick = async () => {
    // Firestore に「未使用」で登録
    const ref = await db.collection("tickets-" + today).add({
        used: false,
        created: new Date(),
    });

    const ticketId = ref.id;

    // QRコード生成（ticketId を埋め込む）
    document.getElementById("qr").innerHTML = "";
    QRCode.toCanvas(ticketId, { width:250 }, (err, canvas) => {
        document.getElementById("qr").appendChild(canvas);
    });

    updateCount();
};
</script>

</body>
</html>
